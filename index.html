<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <link rel="stylesheet" href="./assets/css/style.css"/>
        <script type="text/javascript" src="./assets/js/Sensor.js"></script>
        <script type="text/javascript" src="./assets/js/Meter.js"></script>
        <script type="text/javascript" src="./assets/js/VStrip.js"></script>
        <script type="text/javascript" src="./assets/js/HStrip.js"></script>
        <script type="text/javascript" src="./assets/js/Step.js"></script>
        <script type="text/javascript" src="./assets/js/Fake.js"></script>
        <script type="text/javascript">

var fake = null;
var step = null;

window.addEventListener("load", ev => {
    step = Step.fromFrance();
    const container = document.getElementById("speed_limit");

    // =======

    const rpm_sensor = Sensor.from().start();
    const kmph_sensor = Sensor.from().start();

    // =======
    
    Meter.from("meters", rpm_sensor, {
        title: "RPM",
        value_cleaner: x => (x/1000).toFixed(1),
        value_max: 8000,
    }).render();
    
    Meter.from("meters", kmph_sensor, {
        title: "KMPH",
        value_max: 160,
        percentColor: Meter.percentBlueRed,
    }).render();
    
    // =======
    
    VStrip.from("strips", rpm_sensor, {
        title: "RPM",
        value_cleaner: x => (x/1000).toFixed(1),
        value_max: 8000,
    }).render();
    
    VStrip.from("strips", kmph_sensor, {
        title: "KMPH",
        value_max: 160,
        percentColor: VStrip.percentBlueRed,
    }).render();
    
    // =======
    
    HStrip.from("squares", rpm_sensor, {
        title: "RPM",
        value_cleaner: x => (x/1000).toFixed(1),
        value_max: 8000,
    }).render();
    
    HStrip.from("squares", kmph_sensor, {
        title: "KMPH",
        value_max: 160,
        percentColor: HStrip.percentBlueRed,
    }).render();
    
    // =======
    
    const kmph_cb = x => {
        kmph_sensor.setValue(x);
        
        const level = step.update(x).getLevel();
        container.innerHTML = level;
    }
    
    const options = [
        { callback: (x)=>rpm_sensor.setValue(x)
        , min: 700
        , delta: 200
        , max: 8000
        },
        { callback: kmph_cb
        , min: 0
        , delta: 5
        , max: 220
        },
    ];
    
    fake = Fake.from(options).start(100);
});

        </script>
    </head>
    <body>
        <div id="speed_limit"></div>
        <div id="meters"></div>
        <div id="strips"></div>
        <div id="squares"></div>
    </body>
</html>